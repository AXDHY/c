# 排序算法运行时间比较

以下比较使用 VS2015 x64 Release 环境编译并执行  
排序元素是一个由8个int组成的结构体，其中一个int作为比较的key  
运行时间的绝对值在不同机器及不同编译器上结果区别可能会很大  
统计的时间也存在误差，以下数据仅供参考，且会随着文档变动而更新

表格中的时间单位是**毫秒(ms)**，数值越小即越快  
**Error**表示运行时发生栈溢出。  
表中数据已按排序时间的权重排序

名字对照|中文名
-|-
bubble	|冒泡排序（写法3）
select	|选择排序（写法3）
insert	|插入排序（写法4）
shell	|希尔排序（写法5）
shell_t	|shellsort个人优化版本
qsort	|C标准的qsort函数（写法6）
std:sort|C++ STL的std::sort函数
q_r1	|快速排序优化1
qi_r1	|快速排序优化2，introsort基本实现
qi_r2	|introsort优化版本2，小于16个元素时使用插入排序
qm:m3bb	|快速排序个人优化版本
heap	|堆排序（写法9）
heap_std|堆排序C++ STL版本
merge	|归并排序（写法10）
merg_std|C++ STL的std::stable_sort
merge_2	|归并排序个人优化版本
radix	|基数排序（写法11）
timsort	|timsort排序个人优化版本

写法6的三个快排实现由于容易陷入最坏情况导致栈溢出或计算时间过长，故不参与比较

### 测试数据生成方式

1. n & 1, 0/1数据
2. n ^ 1, 有序数据交换相邻数
3. (1000000000 - n) ^ 1, 逆序数据交换相邻数
4. n, 生成后shuffle, 无序无重复数据
5. n % (len * 90 / 100), 生成后shuffle, 无序10%数据重复
6. n % (len * 50 / 100), 生成后shuffle, 无序50%数据重复
7. n % (len / 100), 生成后shuffle, 无序99%数据重复
8. n % 32, 生成后shuffle, 无序极大量重复数据
9. n % 32, 大量小段有序重复数据
10. n % (int)sqrt(len / 2)), 部分有序大量重复数据
11. n % (len / 16), 大段有序数据

## 排序算法运行时间比较1 （数据规模20K）

test      |  1  |  2  |  3  |  4  |  5  |  6  |  7  |  8  |  9  |  10 |  11 |
----------|----:|----:|----:|----:|----:|----:|----:|----:|----:|----:|----:|
qm:m3bb   |    0|    0|    0|    0|    1|    1|    0|    0|    0|    0|    0|
radix     |    0|    0|    1|    0|    1|    0|    0|    0|    0|    0|    0|
q_r1      |    0|    0|    0|    1|    1|    1|    0|    0|    0|    0|    0|
qi_r1     |    0|    0|    0|    1|    1|    1|    0|    0|    0|    0|    0|
qi_r2     |    0|    0|    0|    1|    1|    1|    0|    0|    0|    0|    0|
merge_2   |    0|    0|    0|    1|    1|    1|    1|    0|    0|    0|    0|
shell     |    0|    0|    0|    1|    1|    1|    1|    1|    0|    0|    0|
std:sort  |    0|    0|    0|    1|    1|    1|    0|    0|    0|    2|    1|
timsort   |    0|    0|    1|    1|    1|    1|    1|    1|    0|    0|    0|
shell_t   |    0|    0|    1|    2|    2|    1|    1|    1|    0|    0|    1|
merg_std  |    1|    0|    1|    1|    1|    1|    1|    1|    1|    1|    1|
heap      |    0|    1|    1|    1|    1|    1|    2|    1|    1|    1|    1|
heap_std  |    1|    1|    1|    1|    1|    1|    1|    1|    1|    1|    1|
merge     |    1|    1|    1|    2|    2|    2|    1|    1|    1|    1|    1|
qsort     |    0|    0|    1|    2|    4|    2|    1|    1|    0|    1|    2|
insert    |  108|    0|  449|  225|  219|  216|  223|  208|  211|  217|  211|
select    |  453|  443|  444|  447|  450|  455|  460|  448|  443|  447|  450|
bubble    |  279|    0| 1519|  853|  854|  847|  878|  829|  786|  824|  801|

## 排序算法运行时间比较2 （数据规模8M）

去掉了前一表中最慢的 bubble, select, insert

test      |  1  |  2  |  3  |  4  |  5  |  6  |  7  |  8  |  9  |  10 |  11 |
----------|----:|----:|----:|----:|----:|----:|----:|----:|----:|----:|----:|
qm:m3bb   |  150|  288|  311|  762|  768|  767|  669|  322|  326|  441|  574|
qi_r2     |  139|  403|  396|  805|  801|  859|  615|  313|  265|  398|  587|
q_r1      |  142|  540|  571|  974|  961|  949|  631|  296|  275|  410|  625|
qi_r1     |  140|  543|  598| 1004|  968|  922|  627|  301|  265|  387|  621|
radix     |  280| 1209| 1571| 1218| 1205| 1201| 1015|  449|  461|  642| 1077|
timsort   |  698|  102| 1221| 1351| 1367| 1363| 1363| 1165| 1030| 1001|  532|
std:sort  |   87|  278|  321|  979|  972|  998|  718|  271|  361| 5458| 1319|
merge_2   |  971|  970| 1020| 1225| 1243| 1234| 1232| 1070|  950|  947| 1006|
qsort     |   98|  630|  713| 1932| 1931| 1947| 1390|  490|  477| 1108| 1804|
shell_t   |  794|  755|  886| 2127| 2116| 2129| 1964| 1351| 1035| 1186| 1267|
merg_std  | 1590| 1519| 1772| 1719| 1723| 1715| 1717| 1684| 1561| 1566| 1701|
merge     | 1618| 1601| 1592| 1880| 1889| 1886| 1873| 1740| 1619| 1594| 1831|
shell     |  859|  773|  915| 3307| 3198| 3174| 3000| 1474| 1032| 1100| 1049|
heap      |  507|  997| 1158| 5359| 5427| 5377| 5281| 1593| 1561| 2962| 2430|
heap_std  | 1413|  963| 1359| 5405| 5453| 5418| 5360| 1648| 1622| 3130| 2755|

下表是 mingw64 gcc 9.1.0 版本使用 `-O1` 编译运行的结果

test      |  1  |  2  |  3  |  4  |  5  |  6  |  7  |  8  |  9  |  10 |  11 |
----------|----:|----:|----:|----:|----:|----:|----:|----:|----:|----:|----:|
qi:m3bb   |  154|  333|  363|  898|  958| 1003|  816|  351|  333|  499|  742|
qi_r2     |  139|  464|  454|  928| 1050| 1007|  735|  349|  303|  454|  698|
qi_r1     |  137|  586|  647| 1082| 1117| 1111|  733|  317|  299|  461|  709|
q_r1      |  140|  599|  641| 1085| 1140| 1088|  768|  358|  287|  481|  688|
radix     |  279| 1216| 1576| 1199| 1248| 1260| 1005|  569|  469|  650| 1026|
timsort   |  817|  116| 1464| 1173| 1230| 1308| 1677| 1382| 1138|  948|  528|
qsort     |   88|  488|  556| 1555| 1659| 1872| 1250|  469|  450|  939| 1339|
std:sort  |  840|  356|  364| 3091|  989| 1196|  921|  846|  831| 1041|  908|
merge_2   | 1167| 1132| 1238| 1463| 1461| 1462| 1470| 1334| 1141| 1108| 1106|
shell_t   |  806|  794| 1071| 1857| 2027| 2072| 2470| 1451| 1075| 1402| 1457|
merg_std  | 1806| 1764| 1860| 1875| 1850| 1888| 1882| 1934| 1805| 1782| 1803|
shell     |  865|  788| 1087| 2049| 2294| 2443| 3781| 1751| 1076| 1316| 1280|
merge     | 1838| 1861| 1832| 2159| 2163| 2152| 2164| 2101| 1872| 1866| 1852|
heap      |  599| 1103| 1221| 2158| 2884| 3631| 5602| 1795| 1614| 3527| 2634|
heap_std  | 1808| 1219| 1560| 2378| 3006| 3881| 5743| 2000| 1840| 3942| 2855|

下表是 centos7 g++ 8.3.1 版本使用 `-O1` 编译运行的结果

test      |  1  |  2  |  3  |  4  |  5  |  6  |  7  |  8  |  9  |  10 |  11 |
----------|----:|----:|----:|----:|----:|----:|----:|----:|----:|----:|----:|
qm:m3bb   |  137|  322|  364| 1129| 1120| 1116|  908|  381|  332|  516|  806|
qi_r2     |  113|  459|  476| 1180| 1150| 1126|  800|  350|  290|  478|  756|
qi_r1     |  108|  612|  707| 1326| 1307| 1234|  797|  300|  273|  476|  747|
q_r1      |  110|  615|  659| 1363| 1282| 1249|  788|  309|  299|  517|  713|
std:sort  |  912|  395|  378| 1134| 1116| 1126| 1001|  952|  945| 1074|  934|
radix     |  289| 1190| 1495| 1152| 1190| 1161|  945|  472|  437|  658| 1006|
qsort     |  677|  572|  589| 1350| 1282| 1282| 1034|  769|  753| 1093|  959|
timsort   |  770|  120| 1380| 1717| 1757| 1672| 1641| 1458|  997|  824|  369|
merge_2   | 1030|  919| 1131| 1484| 1471| 1457| 1391| 1160| 1022|  941|  922|
merg_std  | 1351| 1342| 1452| 1795| 2190| 1743| 1733| 1540| 1407| 1380| 1371|
shell_t   |  815|  810| 1132| 3019| 3008| 2933| 2708| 1522| 1122| 1510| 1572|
merge     | 1841| 1828| 1728| 2273| 2267| 2206| 2146| 1882| 1823| 1850| 1835|
shell     |  892|  851| 1148| 4943| 4925| 4989| 4779| 1705| 1135| 1406| 1401|
heap      |  684| 1362| 1519| 7787| 9334| 8072| 8158| 1852| 1784| 6379| 3324|
heap_std  | 1640| 1382| 1832| 8260|11207| 8252| 8317| 2343| 2067| 6725| 3553|

## 基于比较的排序算法实现本次测试综合表现排行（排除radix）：
1. qm:m3bb
2. qi_r2
3. qi_r1
4. q_r1
5. std:sort
6. timsort
7. merge_2
8. qsort
9. shell_t
10. merg_std
11. merge
12. shell
13. heap
14. heap_std
15. insert
16. select
17. bubble

## 其它要注意的问题

* std::sort在VS以及clang下，在第10组数据下表现特别糟糕，这是我通过源代码发现它实现上问题而构造的数据
* std::sort在mingw下，在第4组数据下表现糟糕，原因不明，而且linux下的gcc却没有这个问题。不要迷信库函数的效率
* 当前的数据规模下优化过的shellsort比heapsort快，所以在introsort里用优化的shellsort替换heapsort能更快一些
* 快速排序里在选择用于划分的元素时，不要采用固定选取（即使3数取中甚至9数取中），最好引入随机或近似随机，否则能比较容易构造出最坏情况
* 大部分你在网上找到的快排代码，其实还不如shellsort，因为很容易遇到导致它栈溢出或需要花费特别长时间的情况。反而shellsort简单易实现还能媲美heapsort
* heap比heap_std快是利用了处理器的执行优化在细节上做的语句次序调整

最后再次声明，以上结果仅供参考，不同编译环境，不同的排序数据会导致结果可能产生较大差异
